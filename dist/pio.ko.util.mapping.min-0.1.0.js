/*! pio.ko.mapping - v0.1.0 - 2013-05-06
* http://PROJECT_WEBSITE/
* Copyright (c) 2013 Micah Smith; Licensed MIT */
var PIO=PIO||{};PIO.util=PIO.util||{},PIO.util.ko=PIO.util.ko||{},PIO.util.ko.mapUtil=function(r,e){var n=function(){var n=this,i=function(r){return function(i,t){return n.map(e.defaults({source:i,destination:t},r))}};this.build=function(i){var t=i.destination||{},a=i.source,o=i.recurse||!0;return e.forEach(a,function(a,u){e.isFunction(a)||(t[u]=e.isArray(a)?0===a.length?r.observableArray([]):o&&(e.isObject(a[0])||e.isPlainObject(a[0]))?r.observableArray(e.map(a,function(r){return n.build(e.defaults({source:r},i))})):r.observableArray(a):e.isPlainObject(a)||e.isObject(a)?o?n.build(e.defaults({source:a},i)):r.observable(a):r.observable(a))}),t},this.map=function(i){var t=i.source,a=i.destination,o=Boolean(i.recurse||!0);return e.isArray(t)||r.isObservable(t)&&e.isArray(t())?n.mapMany(i):(e.forEach(t,function(u,s){if(e.has(a,s)){var c,l,b=function(r){return r()},f=function(r,e){r(e)};e.isFunction(u)?r.isWriteableObservable(u)&&(c=b,l=f):e.isObject(u)&&o&&n.map(e.defaults({source:t[s],destination:a[s]},i)),Boolean(c)&&Boolean(l)&&l(a[s],c(t[s]))}}),void 0)},this.mapMany=function(n){var t=n.source,a=n.destination,o=n.predicate,u=(n.recurse||!0,n.builder||function(r){return r}),s=n.mapper||i(n),c=Boolean(o),l=[];return a||(a=[]),r.isObservable(a)&&e.isArray(a())||(a=r.observableArray(a)),c||a.removeAll(),a().length?(e.forEach(t,function(r){var n=u(r),i=e(a()).find(function(r){return o(r,n)});i?s(n,i):l.push(n)}),e(l).forEach(function(r){a.push(r)})):e(t).forEach(function(r){a.push(u(r))}),a}};return new n}(ko,_);